-- ๐งช ุณูุฑุจุช ููุชุญูู ูู ุฃูุงู ูุณุฎุฉ ุงูุฏููู (Verify Demo Security)
-- ุงูุณุฎ ูุฐุง ุงูููุฏ ูุถุนู ูู Supabase SQL Editor ูุงุถุบุท Run

BEGIN; -- ูุจุฏุฃ ูุนุงููุฉ ูุคูุชุฉ (Transaction)

-- 1. ุฅุนุฏุงุฏ ุงููุชุบูุฑุงุช ููุญุงูุงุฉ ูุณุชุฎุฏู ุงูุฏููู
-- ูููู ุจุถุจุท ุฅุนุฏุงุฏุงุช ุงูุฌูุณุฉ ููุฃููุง ูุณุชุฎุฏู ูุณุฌู ุฏุฎููู ุจุตูุฉ demo
SET LOCAL request.jwt.claims = '{"user_metadata": {"app_role": "demo"}}';
SET LOCAL role = 'authenticated';

-- 2. ูุญุงููุฉ ุฅูุดุงุก ุนููู ุฌุฏูุฏ (ูุฌุจ ุฃู ููุฌุญ ูุฃู ุงูุฏููู ูุณููุญ ูู ุจุงูุฅุถุงูุฉ)
INSERT INTO public.customers (id, name) 
VALUES ('00000000-0000-0000-0000-000000009999', 'ุนููู ุงุฎุชุจุงุฑ ุงูุญูุงูุฉ');

-- 3. ูุญุงููุฉ ุญุฐู ุงูุนููู ุงูุฐู ุชู ุฅูุดุงุคู (ูุฌุจ ุฃู ููุดู ุจุตูุช ุจุณุจุจ RLS - ุฃู ูุง ูุญุฐู ุงูุณุฌู)
DELETE FROM public.customers WHERE id = '00000000-0000-0000-0000-000000009999';

-- 4. ุงูุชุญูู ูู ุงููุชูุฌุฉ (ุฅุฑุฌุงุน ูุต ูุงุถุญ ุจุฏูุงู ูู ุงูุฑุณุงุฆู ุงููุฎููุฉ)
SELECT 
    CASE 
        WHEN EXISTS(SELECT 1 FROM public.customers WHERE id = '00000000-0000-0000-0000-000000009999') THEN 'โ ูุฌุญ ุงูุงุฎุชุจุงุฑ: ุงูุญูุงูุฉ ุชุนูู (ูู ูุชู ุงูุญุฐู)'
        ELSE 'โ ูุดู ุงูุงุฎุชุจุงุฑ: ุชู ุงูุญุฐู'
    END as result;

ROLLBACK; -- ุงูุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช (ุชูุธูู ุงูุจูุงูุงุช ุงูููููุฉ)
